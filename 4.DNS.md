#DNS（Centos7未成功）
<pre>
域名的层级不得超过127层，最长63个字符
类型：
A：正向解析
PTR：反向解析
cname:另外记录
mx:邮箱记录
ns:DNS记录
DNS命名规范：
1. 26个英文字母
2. ‘0到10数字’
3. ‘-’短横线
4. 最多63个字节长度
如果非要不支持以上4个规范，那么在bind配置文件mastero-view上，配置check-name ignore;忽略检查域名
解析命令：
dig,nslookup,host三个linux域名解析命令，linux底层用的是host，例如php解析的就是host命令

TCP和UDP53端口都要开，才能使DNS生效。

#master主DNS服务器搭建：bind软件
1. [root@SaltstackServer ~]# yum install bind-utils bind bind-devel bind-chroot （bind9.8有漏动）
2. [root@SaltstackServer ~]# vim /etc/named.conf
options {
  version "1.1.1";#bind版本
  listen-on port 53 {any;};#dns监听端口
  directory "/var/named/chroot/etc/";  #zone文件所在目录
  pid-file "/var/named/chroot/var/run/named/named.pid";
#bind程序pid的文件目录
  allow-query { any;};#允许访问的目标
  Dump-file "/var/named/chroot/var/log/binddump.db";
  Statistics-file "/var/named/chroot/var/log/named_stats";
#查看dns的成功率，访问信息
  zone-statistics yes;#开启Statistics
  nmemstatistics-file "log/mem_stats";#内存状态
  empty-zones-enable no;#不允许空zone
  forwarders {202.106.196.115;8.8.8.8; };#本身查询不到的dns，我转发给这些dns地址

key "rndc-key" {
        algorithm hmac-md5;
        secret "Eqw4hC1GExUWeDkKBX/pBg==";
};

controls {
        inet 127.0.0.1 port 953
                allow { 127.0.0.1; } keys { "rndc-key"; };
};

logging { #不同警告级别日志存储位置
  channel warning {
    file "/var/named/chroot/var/log/dns_warning" versions 10 size 10m;
    severity warning;
    print-category yes;
    print-severity yes;
    print-time yes;
  };

  channel general_dns {
    file "/var/named/chroot/var/log/dns_log" versions 10 size 100m;
    severity info;
    print-category yes;
    print-severity yes;
    print-time yes;
  };
  chtegory default {
    warning;
  };
  category queries {
    general_dns;
  };

include "/var/named/chroot/etc/view.conf";

};


3. [root@SaltstackServer ~]# vim /etc/rndc.key
key "rndc-key" {
        algorithm hmac-md5;
        secret "Eqw4hC1GExUWeDkKBX/pBg==";
};
4. [root@SaltstackServer ~]# vim /etc/rndc.conf
key "rndc-key" {
        algorithm hmac-md5;
        secret "Eqw4hC1GExUWeDkKBX/pBg==";
};

options {
        default-key "rndc-key";
        default-server 127.0.0.1;
        defalut-port 953;
};

5. [root@SaltstackServer ~]# vim /var/named/chroot/etc/view.conf#配置主从更新的配置
view "View" {
  zone "lnh.com" {
        type    master;
        file    "lnh.com.zone";
        allow-transfer {
                10.255.253.211;#slave同步的地址
        };
        notify  yes;#当masterDNS数据变更了
        also-notify {#就去通知这个dns从我这要更新数据
                10.255.253.211;
        };
  };
};


6. [root@SaltstackServer ~]# vim /var/named/chroot/etc/lnh.com.zone
$ORIGIN .
$TTL 3600       : 1 hour
lnh.com                 IN SOA op.lnh.com. dns.lnh.com. (
                                2000    : serial
                                900     : refresh (15 minutes)
                                86400   : expire (1 day)
                                3600    : minimum (1 hour)
                                )
                        NS      op.lnh.com.
$ORIGIN lnh.com.

shanks                  A       1.2.3.4
op              A       1.2.3.4
a               A       1.2.3.4

7. [root@SaltstackServer /var]# chown -R named.named named/
8. [root@SaltstackServer /var]# systemctl start named
9. [root@SaltstackServer /var]# systemctl enable named

#Slave从DNS服务器
1. [root@SaltstackServer ~]# yum install bind-utils bind bind-devel bind-chroot （bind9.8有漏动）
2. [root@SaltstackServer ~]# vim /etc/named.conf
options {
  version "1.1.1";#bind版本
  listen-on port 53 {any;};#dns监听端口
  directory "/var/named/chroot/etc/";  #zone文件所在目录
  pid-file "/var/named/chroot/var/run/named/named.pid";
#bind程序pid的文件目录
  allow-query { any;};#允许访问的目标
  Dump-file "/var/named/chroot/var/log/binddump.db";
  Statistics-file "/var/named/chroot/var/log/named_stats";
#查看dns的成功率，访问信息
  zone-statistics yes;#开启Statistics
  nmemstatistics-file "log/mem_stats";#内存状态
  empty-zones-enable no;#不允许空zone
  forwarders {202.106.196.115;8.8.8.8; };#本身查询不到的dns，我转发给这些dns地址

key "rndc-key" {
        algorithm hmac-md5;
        secret "Eqw4hC1GExUWeDkKBX/pBg==";
};

controls {
        inet 127.0.0.1 port 953
                allow { 127.0.0.1; } keys { "rndc-key"; };
};

logging { #不同警告级别日志存储位置
  channel warning {
    file "/var/named/chroot/var/log/dns_warning" versions 10 size 10m;
    severity warning;
    print-category yes;
    print-severity yes;
    print-time yes;
  };

  channel general_dns {
    file "/var/named/chroot/var/log/dns_log" versions 10 size 100m;
    severity info;
    print-category yes;
    print-severity yes;
    print-time yes;
  };
  chtegory default {
    warning;
  };
  category queries {
    general_dns;
  };

include "/var/named/chroot/etc/view.conf";

};


3. [root@SaltstackServer ~]# vim /etc/rndc.key
key "rndc-key" {
        algorithm hmac-md5;
        secret "Eqw4hC1GExUWeDkKBX/pBg==";
};
4. [root@SaltstackServer ~]# vim /etc/rndc.conf
key "rndc-key" {
        algorithm hmac-md5;
        secret "Eqw4hC1GExUWeDkKBX/pBg==";
};

options {
        default-key "rndc-key";
        default-server 127.0.0.1;
        defalut-port 953;
};

5. view "SlaveView" {
  zone "lnh.com" {
        type    slave;
        masters    {10.6.0.253;};#主dnsIP地址
        file	"slave.lnh.com.zone";
        };
};
6. 注意：除了更改/etc/named.conf文件要重启named服务外，其他关于bind的配置文件，只需要使用命令rndc reload就可以了

7. [root@SaltstackServer /var]# chown -R named.named named/
8. [root@SaltstackServer /var]# systemctl start named
9. [root@SaltstackServer /var]# systemctl enable named

如何查看主从同步成功？
在slaveDNS上切换到/var/named/chroot/etc目录下，如果有slave.lnh.com.zone文件，说明已经同步成功
slave默认每隔15分钟去跟master进行同步，根据master的修订版本号进行同步的

主从同步成功后，全部操作在master上操作：
[root@SaltstackServer /var]# vim /var/named/chroot/etc/lnh.com.zone#在这个文件下进行a记录等操作，在这个配置文件下更改后一定要修改下修订版本号，一版加1，这样才能使slave同步master的记录过去 


</pre>