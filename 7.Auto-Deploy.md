#持续集成与自动化部署
<pre>
#环境规划：
1. 开发环境：开发者本地有自己的环境，运维需要设置的开发环境：大家共用的服务，例如：开发数据库mysql,其它：redis、memcached.
2. 测试环境：功能测试和性能测试
3. 预生产环境：生产环境集群中的某一个节点担任
4. 生产环境：直接对用户提供服务的环境

预生产环境产生的原因：
数据库不一致：测试环境和生产环境数据库肯定是不一样的
使用生产环境的联调接口。例如：支付接口

#部署
例如：1个集群有10个节点
1. 实现一键部署这10个节点
2. 一键回滚到任意版本
3. 一键回滚到上一个版本

部署的问题：
1. 代码在哪里：git、svn。
2. 获取什么版本代码？
	git+svn直接拉取某个分支
	git:指定标签（tag）
	svn:指定版本号
3. 差异解决：
	1. 配置文件未必一样：代码层面的计划任务crontab.xml导致节点配置不一样、预生产节点
	2. 代码仓库和实际的差异：配置文件是否放在代码仓库中？配置文件只在部署上有。单独的项目而言
4. 如何更新：java程序更新肯定要重启系统，例如java跑在tomcat下就需要重启
5. 测试：测试环境、预生产环境都测过了，还要进行测试（别的公司就遇到过预生产环境没问题一到生产环境就有问题情况），再检查一遍系统的主要功能，以防万一
6. 串行还是并行：分组部署
7. 如何执行：1. shell ./ 执行。	2. web界面执行

部署的流程：
1. 获取代码（直接拉取）
2. 编译（可选）
3. 配置文件放进去
4. 打包
5. scp到目标服务器
6. 将目标服务器移出集群
7. 解压
8. 放到webroot
9. scp差异文件
10. 重启（可选）[php解释型语言，可以不重启，但是如果php开启缓存就得重启]
11. 测试
12. 重新加入集群

#自动化部署实战：
用户：所有的web服务都应该使用普通用户。所有的web服务器都不应该开启80端口，除了负载均衡。（用命令给普通用户设一个suid并且可以启动80端口）
1. 每台机器建立用户：useradd www (给每一个用户设定一个指定的uid)
2. 选中一台为控制机器，用ssh-keygen -t rsa 生成秘钥，并且在所有目标机器包括本身机器的www用户下~/.ssh目录下建立文件authorized_keys文件，写入控制机器的公钥且权限设成600
3. 写部署脚本：





</pre>